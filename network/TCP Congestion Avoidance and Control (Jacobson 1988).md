# TCP Congestion Avoidance and Control (Jacobson 1988)

## 출처
* 링크: https://ee.lbl.gov/papers/congavoid.pdf
* 발표: SIGCOMM '88 (1988년 8월)
* 저자: Van Jacobson (Lawrence Berkeley Laboratory), Michael J. Karels (UC Berkeley)
* 인용 수: 5,600+ (네트워킹 분야 가장 영향력 있는 논문 중 하나)

---

## AI 요약

### 배경: 1986년 혼잡 붕괴 (Congestion Collapse)
1986년 10월, LBL과 UC Berkeley 사이(400야드, IMP 2홉 거리)의 데이터 처리량이 **32 Kbps에서 40 bps로** 1000배 급감하는 "혼잡 붕괴" 현상 발생. 이 사건이 논문의 직접적 계기가 됨.

### 핵심 원리: 패킷 보존 (Conservation of Packets)
> "새로운 패킷은 기존 패킷이 네트워크를 떠날 때까지 투입되어서는 안 된다"

평형 상태의 TCP 연결은 물리학의 "보존 흐름(conservative flow)"처럼 동작해야 함. 혼잡 제어의 핵심은 이 보존 원칙을 위반하는 지점을 찾아 수정하는 것.

### 패킷 보존 실패의 3가지 원인
| 원인 | 설명 | 해결책 |
|------|------|--------|
| 평형 도달 실패 | 연결 시작/재시작 시 | Slow-Start |
| 조기 패킷 주입 | ACK 전에 새 패킷 전송 | RTT 분산 추정, 지수 백오프 |
| 경로 자원 한계 | 버퍼 용량 초과 | Congestion Avoidance (AIMD) |

### 도입된 7가지 알고리즘

#### 1. Slow-Start (느린 시작)
```
연결 시작 시:
  cwnd = 1 packet
  
각 ACK 수신 시:
  cwnd += 1 packet  (지수적 증가: 1→2→4→8...)
```
- 윈도우가 R·log₂W 시간에 열림 (R: RTT, W: 윈도우 크기)
- 최대 경로 대역폭의 2배 속도로만 전송 보장

#### 2. RTT 분산 추정 (Round-Trip Time Variance Estimation)
RFC793의 단순 평균 대신 **평균 + 편차** 사용:
```
Err = m - a                    (예측 오차)
a ← a + g·Err                  (평균 갱신, g=0.125)
v ← v + g·(|Err| - v)          (편차 갱신, g=0.25)
rto = a + 4v                   (재전송 타임아웃)
```

#### 3. 지수적 재전송 백오프 (Exponential Retransmit Timer Backoff)
재전송 실패 시 타임아웃을 지수적으로 증가시켜 네트워크 안정화

#### 4. Congestion Avoidance (혼잡 회피) - AIMD
```
혼잡 감지 시 (타임아웃):
  ssthresh = cwnd / 2          (승법 감소: Multiplicative Decrease)
  cwnd = 1
  
혼잡 없을 때 (ACK 수신):
  cwnd += 1/cwnd               (가법 증가: Additive Increase)
```

**왜 AIMD인가?**
- 승법 감소: 네트워크 혼잡은 지수적으로 증가하므로, 안정화를 위해 지수적 감쇠 필요
- 가법 증가: 승법 증가는 과대추정으로 인한 진동 유발, 선형 증가가 안정적

#### 5. 더 적극적인 수신자 ACK 정책
매 2번째 패킷마다 ACK (vs 기존 5-7 패킷마다)로 버스트 크기 감소

#### 6. Karn's Algorithm
재전송된 패킷의 ACK로는 RTT를 측정하지 않음 (모호성 해결)

#### 7. Fast Retransmit
타임아웃 전에 중복 ACK로 손실 감지 (후속 논문에서 상세화)

### 실험 결과
4개 동시 TCP 연결 테스트 (230.4 Kbps 병목 링크):

| 지표 | 기존 TCP | 개선된 TCP |
|------|---------|-----------|
| 재전송률 | 36% (4,000/11,000) | 1% (89/8,281) |
| 대역폭 활용 | 75% (25% 낭비) | ~100% |
| 공정성 | 편차 심함 (0.5-8 KBps) | 균등 분배 |

### Self-Clocking 메커니즘
```
[Sender] ──packets──> [Bottleneck] ──packets──> [Receiver]
    ↑                                              │
    └──────────────── ACKs ────────────────────────┘
```
- ACK가 "시계" 역할: 병목 링크 속도에 맞춰 자동 조절
- 새 패킷은 ACK 수신 시에만 전송
- 대역폭-지연 변화에 자동 적응

### Slow-Start + Congestion Avoidance 결합
```c
if (cwnd < ssthresh)
    cwnd += 1;              // Slow-start: 지수 증가
else
    cwnd += 1/cwnd;         // Congestion avoidance: 선형 증가
```

---

## 내가 얻은 인사이트

1. **실제 장애에서 시작된 연구**: 1986년 혼잡 붕괴라는 실제 인터넷 장애 경험에서 출발. 이론이 아닌 실측 데이터 기반 연구의 전형적 사례

2. **물리학적 관점의 네트워크 분석**: "패킷 보존"이라는 물리학의 보존 법칙을 네트워크에 적용. Lyapunov 안정성 이론으로 수학적 정당화를 시도한 점이 인상적

3. **AIMD의 비대칭성이 핵심**: 왜 증가는 가법적(+1)이고 감소는 승법적(÷2)인가?
   - 네트워크 혼잡은 지수적으로 악화되므로 지수적 감쇠 필요
   - 대역폭 증가 시 과대추정은 위험, 보수적 접근 필수
   - "가솔린을 불에 붓는 것"이라는 비유가 명쾌함

4. **Self-Clocking의 우아함**: ACK가 자연스럽게 송신 속도를 조절하는 메커니즘. 명시적 rate control 없이 암묵적으로 병목 대역폭에 수렴

5. **분산 추정의 중요성**: RFC793의 고정 β=2는 30% 이상 부하에서 실패. RTT 분산을 추정하여 rto = R + 4V로 계산하는 것이 핵심 개선

6. **게이트웨이(라우터) 역할의 한계 인식**: 논문 말미에서 "공정한 대역폭 공유는 게이트웨이에서만 가능"하다고 인정. 이는 후속 RED, ECN 등의 연구로 이어짐

7. **인터넷을 구한 논문**: 이 논문의 알고리즘이 4.3BSD TCP에 구현되어 모든 현대 TCP의 기반이 됨. 이것 없이는 인터넷이 지속적으로 혼잡 붕괴를 겪었을 것

8. **"거의 모든" 조건의 중요성**: 지수 백오프조차 무한 사용자 집단에서는 안정성을 보장하지 못함. 하지만 현실에서는 "거의" 동작함

9. **시스템적 비용 관점**: 윈도우를 절반으로 줄이는 것이 과해 보이지만, 시스템 전체로 보면 큐를 비우는 데 필요한 정확한 시간을 확보하는 것

10. **35년이 지난 지금도 유효**: BBR, CUBIC 등 현대 혼잡 제어도 이 논문의 기본 원칙(패킷 보존, self-clocking) 위에 구축됨