# Web Caching with Consistent Hashing

## 출처
- 링크: https://www.cs.cmu.edu/~srini/15-744/S02/readings/K%2B99.html
- 저자: David Karger 외 (MIT)
- 발표: 1999년

---

## AI 요약

### 1. 배경 및 문제의식
- 웹 트래픽 증가로 서버/네트워크 병목, 지연, 실패가 빈번해짐.
- 웹 캐싱은 사용자 근처에서 데이터를 제공해 성능과 신뢰성을 높이는 핵심 전략.
- 기존 캐싱 시스템(단일 캐시, 브로드캐스트, 디렉터리 기반)은 확장성, 중복, 장애 허용성, 부하 분산에 한계가 있음.

### 2. Consistent Hashing 기반 캐싱의 핵심 아이디어
- **Consistent Hashing**: URL(혹은 객체)을 해시하여 여러 캐시 서버 중 하나에 “일관성 있게” 매핑.
  - 서버 추가/제거 시 전체 데이터 재배치가 아니라 일부만 이동 → 캐시 효율 극대화, 장애/확장에 강함.
  - 각 URL과 캐시 서버를 “원(circle)” 위에 해시로 배치, URL은 시계방향으로 가장 가까운 서버에 할당.
- **클라이언트가 직접 해시**: 브라우저(또는 프록시)가 URL을 해시해 해당 캐시로 직접 요청 → 중간 캐시 간 통신 불필요, 중복 저장 최소화.
- **DNS 활용**: 실제 구현에서는 브라우저의 한계(자동화된 캐시 서버 목록 갱신, 동적 해시 적용 불가 등)로 인해, DNS를 활용해 가상 캐시 이름을 실제 캐시 IP로 매핑. (자세한 설명은 아래 참고)

### 3. 주요 구현 및 실험 결과
- **Squid 프록시**와 Consistent Hashing 기반 DNS 시스템으로 구현.
- **실험 방식**:
  - 7대의 머신(3대는 Squid 프록시, 1대는 웹 서버, 1대는 Consistent Hashing DNS, 1대는 테스트 드라이버, 1대는 비교 시스템용)으로 테스트 환경 구성
  - Surge(웹 부하 생성기)로 1500개 파일(총 34MB)과 다양한 요청 시나리오 생성
  - Common Mode(기존 방식, 각 클라이언트가 고정 캐시 사용)와 Cache Resolver Mode(Consistent Hashing 적용) 비교
  - 캐시 용량(9~36MB) 변화, 캐시 간 통신/브로드캐스트/디렉터리 기반 등 다양한 구성 실험
  - 각 실험에서 캐시 미스율, 부하 분산, 데이터 중복, 응답 시간 등 측정
- **실험 결과**:
  - 해시 연산은 평균 20마이크로초(전체 응답 시간의 0.1% 미만)로 매우 빠름
  - 캐시 분산도(표준편차)는 전체 평균의 3% 이내로 매우 균등
  - Cache Resolver Mode가 Common Mode 대비 캐시 미스율이 낮고, 캐시 용량이 작을수록 효과가 더 큼
  - 기존 방식은 캐시 간 중복 저장, 추가 통신, 단일 장애점 등 단점이 두드러짐
  - Consistent Hashing은 서버 추가/제거, 장애 발생 시에도 데이터 재배치 최소화 및 서비스 지속 가능
  - 핫 페이지(Hot Page)는 DNS가 여러 캐시로 분산시켜 부하 집중 방지
  - 지역성(Locality): 지역별 DNS 계층을 두어, 사용자가 가까운 캐시를 우선 사용하도록 설계

### 실제 구현에서의 브라우저 한계란?
- 브라우저의 자동화/동적 구성 한계: 당시(1999년) 브라우저는 자바스크립트로 프록시 목록을 동적으로 갱신하거나, 캐시 서버 추가/제거에 따라 해시 함수를 실시간으로 업데이트하는 기능이 부족했음
- 오토컨피그 스크립트는 수동 갱신이 필요하고, 캐시 서버 변화에 즉각 대응 불가
- DNS를 활용해 가상 캐시 이름을 실제 IP로 동적으로 매핑함으로써, 브라우저의 한계를 우회하고 Consistent Hashing의 장점을 실현함
- 이 구조는 브라우저가 직접 해시를 수행하는 이상적인 구조에 비해, DNS 의존성이 생기지만, 당시 기술적 한계에서 가장 실용적인 해법이었음

### 4. 실용적 인사이트
- **확장성**: 서버 추가/제거가 빈번한 환경(클라우드, CDN 등)에서 매우 효과적.
- **장애 허용성**: 일부 캐시 장애에도 전체 시스템이 정상 동작, 단일 장애점 없음.
- **운영 단순화**: 캐시 간 동기화/브로드캐스트/디렉터리 관리 불필요, 네트워크 트래픽 감소.
- **부하 분산**: 해시 기반 자동 분산, 핫스팟 발생 시 DNS로 동적 분산 가능.
- **적용 예시**: 대규모 웹 서비스, CDN, 분산 캐시 시스템(예: Memcached, DynamoDB 등)에서 널리 활용.

---

## 내가 얻은 인사이트
